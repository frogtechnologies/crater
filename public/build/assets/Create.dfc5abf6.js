import{J as A,G as J,aN as O,B as _,k as b,L as m,M as v,T as Q,r as u,o as w,l as V,w as i,f as o,u as e,h,e as K,y as W,F as X,m as Y,j as Z,i as x,t as ee,U as ae,N as C,Q as te,O as oe}from"./vendor.8669b7df.js";import{b as se}from"./main.8525167c.js";import{V as ne}from"./index.esm.0704c981.js";import{u as re}from"./users.48000179.js";const le=["onSubmit"],ie={class:"grid grid-cols-12"},ue={class:"space-y-6"},fe={setup(de){const a=re(),{t:d}=A(),y=J(),S=O(),k=se();let c=_(!1),r=_(!1);_([]);let q=_([]);const p=b(()=>y.name==="users.edit"),I=b(()=>p.value?d("users.edit_user"):d("users.new_user")),j=b(()=>({userData:{name:{required:m.withMessage(d("validation.required"),v),minLength:m.withMessage(d("validation.name_min_length",{count:3}),C(3))},email:{required:m.withMessage(d("validation.required"),v),email:m.withMessage(d("validation.email_incorrect"),te)},password:{required:oe(function(){return m.withMessage(d("validation.required"),v),!p.value}),minLength:m.withMessage(d("validation.password_min_length",{count:8}),C(8))},companies:{required:m.withMessage(d("validation.required"),v)}}})),N={role:{required:m.withMessage(d("validation.required"),v)}},s=Q(j,a,{$scope:!0});G(),a.resetUserData();async function G(){r.value=!0;try{p.value&&await a.fetchUser(y.params.id);let l=await k.fetchUserCompanies();l?.data?.data&&(q.value=l.data.data.map(t=>(t.role=null,t)))}catch{r.value=!1}r.value=!1}async function L(){if(s.value.$touch(),s.value.$invalid)return!0;try{c.value=!0;let l={...a.userData,companies:a.userData.companies.map(g=>({role:g.role,id:g.id}))};await(p.value?a.updateUser:a.addUser)(l),S.push("/admin/users"),c.value=!1}catch{c.value=!1}}return(l,t)=>{const g=u("BaseBreadcrumbItem"),P=u("BaseBreadcrumb"),E=u("BasePageHeader"),$=u("BaseInput"),f=u("BaseInputGroup"),M=u("BaseMultiselect"),F=u("BaseInputGrid"),R=u("BaseIcon"),T=u("BaseButton"),H=u("BaseCard"),z=u("BasePage");return w(),V(z,null,{default:i(()=>[o(E,{title:e(I)},{default:i(()=>[o(P,null,{default:i(()=>[o(g,{title:l.$t("general.home"),to:"dashboard"},null,8,["title"]),o(g,{title:l.$tc("users.user",2),to:"/admin/users"},null,8,["title"]),o(g,{title:e(I),to:"#",active:""},null,8,["title"])]),_:1})]),_:1},8,["title"]),h("form",{action:"",autocomplete:"off",onSubmit:ae(L,["prevent"])},[h("div",ie,[o(H,{class:"mt-6 col-span-12 md:col-span-8"},{default:i(()=>[o(F,{layout:"one-column"},{default:i(()=>[o(f,{"content-loading":e(r),label:l.$t("users.name"),error:e(s).userData.name.$error&&e(s).userData.name.$errors[0].$message,required:""},{default:i(()=>[o($,{modelValue:e(a).userData.name,"onUpdate:modelValue":t[0]||(t[0]=n=>e(a).userData.name=n),modelModifiers:{trim:!0},"content-loading":e(r),invalid:e(s).userData.name.$error,onInput:t[1]||(t[1]=n=>e(s).userData.name.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["content-loading","label","error"]),o(f,{"content-loading":e(r),label:l.$t("users.email"),error:e(s).userData.email.$error&&e(s).userData.email.$errors[0].$message,required:""},{default:i(()=>[o($,{modelValue:e(a).userData.email,"onUpdate:modelValue":t[2]||(t[2]=n=>e(a).userData.email=n),modelModifiers:{trim:!0},type:"email","content-loading":e(r),invalid:e(s).userData.email.$error,onInput:t[3]||(t[3]=n=>e(s).userData.email.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["content-loading","label","error"]),o(f,{"content-loading":e(r),label:l.$t("users.companies"),error:e(s).userData.companies.$error&&e(s).userData.companies.$errors[0].$message,required:""},{default:i(()=>[o(M,{modelValue:e(a).userData.companies,"onUpdate:modelValue":t[4]||(t[4]=n=>e(a).userData.companies=n),mode:"tags",object:!0,autocomplete:"new-password",label:"name",options:e(q),"value-prop":"id",invalid:e(s).userData.companies.$error,"content-loading":e(r),searchable:"","can-deselect":!1,class:"w-full"},null,8,["modelValue","options","invalid","content-loading"])]),_:1},8,["content-loading","label","error"]),(w(!0),K(X,null,W(e(a).userData.companies,(n,D)=>(w(),V(e(ne),{key:D,state:n,rules:N},{default:i(({v:B})=>[h("div",ue,[o(f,{"content-loading":e(r),label:l.$t("users.select_company_role",{company:n.name}),error:B.role.$error&&B.role.$errors[0].$message,required:""},{default:i(()=>[o(M,{modelValue:e(a).userData.companies[D].role,"onUpdate:modelValue":U=>e(a).userData.companies[D].role=U,"value-prop":"name","track-by":"id",autocomplete:"off","content-loading":e(r),label:"name",options:e(a).userData.companies[D].roles,"can-deselect":!1,invalid:B.role.$invalid,onChange:U=>B.role.$touch()},null,8,["modelValue","onUpdate:modelValue","content-loading","options","invalid","onChange"])]),_:2},1032,["content-loading","label","error"])])]),_:2},1032,["state"]))),128)),o(f,{"content-loading":e(r),label:l.$tc("users.password"),error:e(s).userData.password.$error&&e(s).userData.password.$errors[0].$message,required:!e(p)},{default:i(()=>[o($,{modelValue:e(a).userData.password,"onUpdate:modelValue":t[5]||(t[5]=n=>e(a).userData.password=n),name:"new-password",autocomplete:"new-password","content-loading":e(r),type:"password",invalid:e(s).userData.password.$error,onInput:t[6]||(t[6]=n=>e(s).userData.password.$touch())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["content-loading","label","error","required"]),o(f,{"content-loading":e(r),label:l.$t("users.phone")},{default:i(()=>[o($,{modelValue:e(a).userData.phone,"onUpdate:modelValue":t[7]||(t[7]=n=>e(a).userData.phone=n),modelModifiers:{trim:!0},"content-loading":e(r)},null,8,["modelValue","content-loading"])]),_:1},8,["content-loading","label"])]),_:1}),o(T,{"content-loading":e(r),type:"submit",loading:e(c),disabled:e(c),class:"mt-6"},{left:i(n=>[e(c)?Z("",!0):(w(),V(R,{key:0,name:"SaveIcon",class:Y(n.class)},null,8,["class"]))]),default:i(()=>[x(" "+ee(e(p)?l.$t("users.update_user"):l.$t("users.save_user")),1)]),_:1},8,["content-loading","loading","disabled"])]),_:1})])],40,le)]),_:1})}}};export{fe as default};
