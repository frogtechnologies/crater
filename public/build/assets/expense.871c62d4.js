import{I as f,a as c,d as E}from"./vendor.8669b7df.js";import{h as l,s as h,u as o}from"./main.8525167c.js";var r={expense_category_id:null,expense_date:f().format("YYYY-MM-DD"),amount:100,notes:"",attachment_receipt:null,customer_id:"",currency_id:"",payment_method_id:"",receiptFiles:[],customFields:[],fields:[],in_use:!1,selectedCurrency:null};const w=(x=!1)=>{const m=x?window.pinia.defineStore:E,{global:d}=window.i18n;return m({id:"expense",state:()=>({expenses:[],totalExpenses:0,selectAllField:!1,selectedExpenses:[],paymentModes:[],showExchangeRate:!1,currentExpense:{...r}}),getters:{getCurrentExpense:t=>t.currentExpense,getSelectedExpenses:t=>t.selectedExpenses},actions:{resetCurrentExpenseData(){this.currentExpense={...r}},fetchExpenses(t){return new Promise((n,i)=>{c.get("/api/v1/expenses",{params:t}).then(e=>{this.expenses=e.data.data,this.totalExpenses=e.data.meta.expense_total_count,n(e)}).catch(e=>{l(e),i(e)})})},fetchExpense(t){return new Promise((n,i)=>{c.get(`/api/v1/expenses/${t}`).then(e=>{e.data&&(Object.assign(this.currentExpense,e.data.data),this.currentExpense.selectedCurrency=e.data.data.currency,e.data.data.attachment_receipt?h.isImageFile(e.data.data.attachment_receipt_meta.mime_type)?this.currentExpense.receiptFiles=[{image:`/expenses/${t}/receipt`}]:this.currentExpense.receiptFiles=[{type:"document",name:e.data.data.attachment_receipt_meta.file_name}]:this.currentExpense.receiptFiles=[]),n(e)}).catch(e=>{l(e),i(e)})})},addExpense(t){const n=h.toFormData(t);return new Promise((i,e)=>{c.post("/api/v1/expenses",n).then(s=>{this.expenses.push(s.data),o().showNotification({type:"success",message:d.t("expenses.created_message")}),i(s)}).catch(s=>{l(s),e(s)})})},updateExpense({id:t,data:n}){const i=o(),e=h.toFormData(n);return e.append("_method","PUT"),new Promise(s=>{c.post(`/api/v1/expenses/${t}`,e).then(a=>{let p=this.expenses.findIndex(u=>u.id===a.data.id);this.expenses[p]=n.expense,i.showNotification({type:"success",message:d.t("expenses.updated_message")}),s(a)})}).catch(s=>{l(s),reject(s)})},setSelectAllState(t){this.selectAllField=t},selectExpense(t){this.selectedExpenses=t,this.selectedExpenses.length===this.expenses.length?this.selectAllField=!0:this.selectAllField=!1},selectAllExpenses(t){if(this.selectedExpenses.length===this.expenses.length)this.selectedExpenses=[],this.selectAllField=!1;else{let n=this.expenses.map(i=>i.id);this.selectedExpenses=n,this.selectAllField=!0}},deleteExpense(t){const n=o();return new Promise((i,e)=>{c.post("/api/v1/expenses/delete",t).then(s=>{let a=this.expenses.findIndex(p=>p.id===t);this.expenses.splice(a,1),n.showNotification({type:"success",message:d.tc("expenses.deleted_message",1)}),i(s)}).catch(s=>{l(s),e(s)})})},deleteMultipleExpenses(){const t=o();return new Promise((n,i)=>{c.post("/api/v1/expenses/delete",{ids:this.selectedExpenses}).then(e=>{this.selectedExpenses.forEach(s=>{let a=this.expenses.findIndex(p=>p.id===s.id);this.expenses.splice(a,1)}),t.showNotification({type:"success",message:d.tc("expenses.deleted_message",2)}),n(e)}).catch(e=>{l(e),i(e)})})},fetchPaymentModes(t){return new Promise((n,i)=>{c.get("/api/v1/payment-methods",{params:t}).then(e=>{this.paymentModes=e.data.data,n(e)}).catch(e=>{l(e),i(e)})})}}})()};export{w as u};
