import{G as N,B as k,a0 as K,k as R,C as j,D as Q,r as d,o as y,e as D,h as g,f as t,u as e,t as L,w as c,l as w,j as p,F as E,$ as W,J as X,aN as Z,L as b,M as q,O as U,aP as ee,T as ne,m as ie,i as te,U as re}from"./vendor.8669b7df.js";import{_ as ae,a as oe,b as le,c as se,d as ce,e as ue,f as de}from"./SalesTax.3b22b97c.js";import{t as P,d as ge,b as ve,m as me,r as fe}from"./main.8525167c.js";import{_ as ye}from"./ExchangeRateConverter.d597caa4.js";import{_ as be}from"./CreateCustomFields.e2de0188.js";import{_ as Ie}from"./TaxTypeModal.500864b3.js";import"./DragIcon.37a311b6.js";import"./SelectNotePopup.185af238.js";import"./NoteModal.a73583a2.js";import"./payment.dbc88c1c.js";import"./exchange-rate.664632a5.js";const $e={class:"col-span-5 pr-0"},we={class:"flex mt-7"},_e={class:"relative w-20 mt-8"},Re={class:"ml-2"},qe={class:"p-0 mb-1 leading-snug text-left text-black"},pe={class:"p-0 m-0 text-xs leading-tight text-left text-gray-500",style:{"max-width":"480px"}},Be={class:"grid grid-cols-1 col-span-7 gap-4 mt-8 lg:gap-6 lg:mt-0 lg:grid-cols-2"},he={props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(n){const a=n,S=N(),i=P(),V=ge(),I=k(!1),u=K([{label:"None",value:"NONE"},{label:"Date",value:"DATE"},{label:"Count",value:"COUNT"}]),v=R(()=>i.newRecurringInvoice.selectedFrequency&&i.newRecurringInvoice.selectedFrequency.value==="CUSTOM"),T=R(()=>a.isEdit?V.config.recurring_invoice_status.update_status:V.config.recurring_invoice_status.create_status);j(()=>i.newRecurringInvoice.selectedFrequency,l=>{i.isFetchingInitialSettings||(l&&l.value!=="CUSTOM"?i.newRecurringInvoice.frequency=l.value:i.newRecurringInvoice.frequency=null)}),Q(()=>{S.params.id||m()});function _(l){return i.newRecurringInvoice.limit_by===l}const C=W(()=>{m()},500);async function m(){const l=i.newRecurringInvoice.frequency;if(!l)return;I.value=!0;let r={starts_at:i.newRecurringInvoice.starts_at,frequency:l};try{await i.fetchRecurringInvoiceFrequencyDate(r)}catch(B){console.error(B),I.value=!1}I.value=!1}return(l,r)=>{const B=d("BaseCustomerSelectPopup"),M=d("BaseSwitch"),$=d("BaseDatePicker"),f=d("BaseInputGroup"),h=d("BaseMultiselect"),s=d("BaseInput");return y(),D(E,null,[g("div",$e,[t(B,{modelValue:e(i).newRecurringInvoice.customer,"onUpdate:modelValue":r[0]||(r[0]=o=>e(i).newRecurringInvoice.customer=o),valid:n.v.customer_id,"content-loading":n.isLoading,type:"recurring-invoice"},null,8,["modelValue","valid","content-loading"]),g("div",we,[g("div",_e,[t(M,{modelValue:e(i).newRecurringInvoice.send_automatically,"onUpdate:modelValue":r[1]||(r[1]=o=>e(i).newRecurringInvoice.send_automatically=o),class:"absolute -top-4"},null,8,["modelValue"])]),g("div",Re,[g("p",qe,L(l.$t("recurring_invoices.send_automatically")),1),g("p",pe,L(l.$t("recurring_invoices.send_automatically_desc")),1)])])]),g("div",Be,[t(f,{label:l.$t("recurring_invoices.starts_at"),"content-loading":n.isLoading,required:"",error:n.v.starts_at.$error&&n.v.starts_at.$errors[0].$message},{default:c(()=>[t($,{modelValue:e(i).newRecurringInvoice.starts_at,"onUpdate:modelValue":r[2]||(r[2]=o=>e(i).newRecurringInvoice.starts_at=o),"content-loading":n.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar",invalid:n.v.starts_at.$error,onChange:r[3]||(r[3]=o=>m())},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","error"]),t(f,{label:l.$t("recurring_invoices.next_invoice_date"),"content-loading":n.isLoading,required:""},{default:c(()=>[t($,{modelValue:e(i).newRecurringInvoice.next_invoice_at,"onUpdate:modelValue":r[4]||(r[4]=o=>e(i).newRecurringInvoice.next_invoice_at=o),"content-loading":n.isLoading,"calendar-button":!0,disabled:!0,loading:I.value,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading","loading"])]),_:1},8,["label","content-loading"]),t(f,{label:l.$t("recurring_invoices.limit_by"),"content-loading":n.isLoading,class:"lg:mt-0",required:"",error:n.v.limit_by.$error&&n.v.limit_by.$errors[0].$message},{default:c(()=>[t(h,{modelValue:e(i).newRecurringInvoice.limit_by,"onUpdate:modelValue":r[5]||(r[5]=o=>e(i).newRecurringInvoice.limit_by=o),"content-loading":n.isLoading,options:e(u),label:"label",invalid:n.v.limit_by.$error,"value-prop":"value"},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),_("DATE")?(y(),w(f,{key:0,label:l.$t("recurring_invoices.limit_date"),"content-loading":n.isLoading,required:_("DATE"),error:n.v.limit_date.$error&&n.v.limit_date.$errors[0].$message},{default:c(()=>[t($,{modelValue:e(i).newRecurringInvoice.limit_date,"onUpdate:modelValue":r[6]||(r[6]=o=>e(i).newRecurringInvoice.limit_date=o),"content-loading":n.isLoading,invalid:n.v.limit_date.$error,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","required","error"])):p("",!0),_("COUNT")?(y(),w(f,{key:1,label:l.$t("recurring_invoices.count"),"content-loading":n.isLoading,required:_("COUNT"),error:n.v.limit_count.$error&&n.v.limit_count.$errors[0].$message},{default:c(()=>[t(s,{modelValue:e(i).newRecurringInvoice.limit_count,"onUpdate:modelValue":r[7]||(r[7]=o=>e(i).newRecurringInvoice.limit_count=o),"content-loading":n.isLoading,invalid:n.v.limit_count.$error,type:"number"},null,8,["modelValue","content-loading","invalid"])]),_:1},8,["label","content-loading","required","error"])):p("",!0),t(f,{label:l.$t("recurring_invoices.status"),required:"","content-loading":n.isLoading,error:n.v.status.$error&&n.v.status.$errors[0].$message},{default:c(()=>[t(h,{modelValue:e(i).newRecurringInvoice.status,"onUpdate:modelValue":r[8]||(r[8]=o=>e(i).newRecurringInvoice.status=o),options:e(T),"content-loading":n.isLoading,invalid:n.v.status.$error,placeholder:l.$t("recurring_invoices.select_a_status"),"value-prop":"value",label:"value"},null,8,["modelValue","options","content-loading","invalid","placeholder"])]),_:1},8,["label","content-loading","error"]),t(f,{label:l.$t("recurring_invoices.frequency.select_frequency"),required:"","content-loading":n.isLoading,error:n.v.selectedFrequency.$error&&n.v.selectedFrequency.$errors[0].$message},{default:c(()=>[t(h,{modelValue:e(i).newRecurringInvoice.selectedFrequency,"onUpdate:modelValue":r[9]||(r[9]=o=>e(i).newRecurringInvoice.selectedFrequency=o),"content-loading":n.isLoading,options:e(i).frequencies,label:"label",invalid:n.v.selectedFrequency.$error,object:"",onChange:m},null,8,["modelValue","content-loading","options","invalid"])]),_:1},8,["label","content-loading","error"]),e(v)?(y(),w(f,{key:2,label:l.$t("recurring_invoices.frequency.title"),"content-loading":n.isLoading,required:"",error:n.v.frequency.$error&&n.v.frequency.$errors[0].$message},{default:c(()=>[t(s,{modelValue:e(i).newRecurringInvoice.frequency,"onUpdate:modelValue":[r[10]||(r[10]=o=>e(i).newRecurringInvoice.frequency=o),e(C)],"content-loading":n.isLoading,disabled:!e(v),invalid:n.v.frequency.$error,loading:I.value},null,8,["modelValue","content-loading","disabled","invalid","loading","onUpdate:modelValue"])]),_:1},8,["label","content-loading","error"])):p("",!0),t(ye,{store:e(i),"store-prop":"newRecurringInvoice",v:n.v,"is-loading":n.isLoading,"is-edit":n.isEdit,"customer-currency":e(i).newRecurringInvoice.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])])],64)}}},Se=["onSubmit"],Ve={class:"flex"},Ce={class:"grid-cols-12 gap-8 mt-6 mb-8 lg:grid"},Fe={class:"block mt-10 invoice-foot lg:flex lg:justify-between lg:items-start"},Le={class:"w-full relative lg:w-1/2"},Ae={setup(n){const a=P(),S=ve(),i=me(),V=fe(),I="newRecurringInvoice",{t:u}=X();let v=k(!1);const T=k(["customer","company","customerCustom","invoice","invoiceCustom"]);let _=N(),C=Z(),m=R(()=>a.isFetchingInvoice||a.isFetchingInitialSettings),l=R(()=>r.value?u("recurring_invoices.edit_invoice"):u("recurring_invoices.new_invoice")),r=R(()=>_.name==="recurring-invoices.edit");const B=R(()=>S.selectedCompanySettings.sales_tax_us_enabled==="YES"&&V.salesTaxUSEnabled),M={starts_at:{required:b.withMessage(u("validation.required"),q)},status:{required:b.withMessage(u("validation.required"),q)},frequency:{required:b.withMessage(u("validation.required"),q)},limit_by:{required:b.withMessage(u("validation.required"),q)},limit_date:{required:b.withMessage(u("validation.required"),U(function(){return a.newRecurringInvoice.limit_by==="DATE"}))},limit_count:{required:b.withMessage(u("validation.required"),U(function(){return a.newRecurringInvoice.limit_by==="COUNT"}))},selectedFrequency:{required:b.withMessage(u("validation.required"),q)},customer_id:{required:b.withMessage(u("validation.required"),q)},exchange_rate:{required:U(function(){return b.withMessage(u("validation.required"),q),a.showExchangeRate}),decimal:b.withMessage(u("validation.valid_exchange_rate"),ee)}},$=ne(M,R(()=>a.newRecurringInvoice),{$scope:I});a.resetCurrentRecurringInvoice(),a.fetchRecurringInvoiceInitialSettings(r.value),i.resetCustomFields(),$.value.$reset,j(()=>a.newRecurringInvoice.customer,s=>{s&&s.currency?a.newRecurringInvoice.currency=s.currency:a.newRecurringInvoice.currency=S.selectedCompanyCurrency});async function f(){if($.value.$touch(),$.value.$invalid)return!1;v.value=!0;let s={...a.newRecurringInvoice,sub_total:a.getSubTotal,total:a.getTotal,tax:a.getTotalTax};_.params.id?a.updateRecurringInvoice(s).then(o=>{o.data.data&&C.push(`/admin/recurring-invoices/${o.data.data.id}/view`),v.value=!1}).catch(o=>{v.value=!1}):h(s)}function h(s){a.addRecurringInvoice(s).then(o=>{o.data.data&&C.push(`/admin/recurring-invoices/${o.data.data.id}/view`),v.value=!1}).catch(o=>{v.value=!1})}return(s,o)=>{const F=d("BaseBreadcrumbItem"),O=d("BaseBreadcrumb"),x=d("BaseButton"),A=d("router-link"),G=d("BaseIcon"),H=d("BasePageHeader"),z=d("BaseScrollPane"),J=d("BasePage");return y(),D(E,null,[t(ae),t(oe),t(Ie),e(B)&&!e(m)?(y(),w(le,{key:0,store:e(a),"store-prop":"newRecurringInvoice","is-edit":e(r),customer:e(a).newRecurringInvoice.customer},null,8,["store","is-edit","customer"])):p("",!0),t(J,{class:"relative invoice-create-page"},{default:c(()=>[g("form",{onSubmit:re(f,["prevent"])},[t(H,{title:e(l)},{actions:c(()=>[t(A,{to:`/invoices/pdf/${e(a).newRecurringInvoice.unique_hash}`},{default:c(()=>[s.$route.name==="invoices.edit"?(y(),w(x,{key:0,target:"_blank",class:"mr-3",variant:"primary-outline",type:"button"},{default:c(()=>[g("span",Ve,L(s.$t("general.view_pdf")),1)]),_:1})):p("",!0)]),_:1},8,["to"]),t(x,{loading:e(v),disabled:e(v),variant:"primary",type:"submit"},{left:c(Y=>[e(v)?p("",!0):(y(),w(G,{key:0,name:"SaveIcon",class:ie(Y.class)},null,8,["class"]))]),default:c(()=>[te(" "+L(s.$t("recurring_invoices.save_invoice")),1)]),_:1},8,["loading","disabled"])]),default:c(()=>[t(O,null,{default:c(()=>[t(F,{title:s.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),t(F,{title:s.$t("recurring_invoices.title",2),to:"/admin/recurring-invoices"},null,8,["title"]),s.$route.name==="invoices.edit"?(y(),w(F,{key:0,title:s.$t("recurring_invoices.edit_invoice"),to:"#",active:""},null,8,["title"])):(y(),w(F,{key:1,title:e(l),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),g("div",Ce,[t(he,{v:e($),"is-loading":e(m),"is-edit":e(r)},null,8,["v","is-loading","is-edit"])]),t(z,null,{default:c(()=>[t(se,{currency:e(a).newRecurringInvoice.currency,"is-loading":e(m),"item-validation-scope":I,store:e(a),"store-prop":"newRecurringInvoice"},null,8,["currency","is-loading","store"]),g("div",Fe,[g("div",Le,[t(ce,{store:e(a),"store-prop":"newRecurringInvoice",fields:T.value,type:"Invoice"},null,8,["store","fields"]),t(be,{type:"Invoice","is-edit":e(r),"is-loading":e(m),store:e(a),"store-prop":"newRecurringInvoice","custom-field-scope":I,class:"mb-6"},null,8,["is-edit","is-loading","store"]),t(ue,{store:e(a),"store-prop":"newRecurringInvoice"},null,8,["store"])]),t(de,{currency:e(a).newRecurringInvoice.currency,"is-loading":e(m),store:e(a),"store-prop":"newRecurringInvoice","tax-popup-type":"invoice"},null,8,["currency","is-loading","store"])])]),_:1})],40,Se)]),_:1})],64)}}};export{Ae as default};
