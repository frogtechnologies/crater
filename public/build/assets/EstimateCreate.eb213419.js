import{r as i,o as p,e as x,f as a,u as e,w as o,J as O,B as I,G as z,aN as J,k as b,L as f,M as E,S as Y,O as A,aP as K,T as Q,C as W,l as y,j as h,h as B,t as V,m as X,i as Z,U as ee,F as te}from"./vendor.8669b7df.js";import{k as j,r as ae,b as se,m as ne}from"./main.8525167c.js";import{_ as ie,a as oe,b as le,c as re,d as me,e as de,f as ue}from"./SalesTax.3b22b97c.js";import{_ as ce}from"./CreateCustomFields.e2de0188.js";import{_ as pe}from"./ExchangeRateConverter.d597caa4.js";import{_ as ge}from"./TaxTypeModal.500864b3.js";import"./DragIcon.37a311b6.js";import"./SelectNotePopup.185af238.js";import"./NoteModal.a73583a2.js";import"./payment.dbc88c1c.js";import"./exchange-rate.664632a5.js";const _e={class:"md:grid-cols-12 grid-cols-1 md:gap-x-6 mt-6 mb-8 grid gap-y-5"},fe={props:{v:{type:Object,default:null},isLoading:{type:Boolean,default:!1},isEdit:{type:Boolean,default:!1}},setup(s){const t=j();return(v,l)=>{const $=i("BaseCustomerSelectPopup"),r=i("BaseDatePicker"),u=i("BaseInputGroup"),c=i("BaseInput"),S=i("BaseInputGrid");return p(),x("div",_e,[a($,{modelValue:e(t).newEstimate.customer,"onUpdate:modelValue":l[0]||(l[0]=m=>e(t).newEstimate.customer=m),valid:s.v.customer_id,"content-loading":s.isLoading,type:"estimate",class:"col-span-5 pr-0"},null,8,["modelValue","valid","content-loading"]),a(S,{class:"col-span-7"},{default:o(()=>[a(u,{label:v.$t("reports.estimates.estimate_date"),"content-loading":s.isLoading,required:"",error:s.v.estimate_date.$error&&s.v.estimate_date.$errors[0].$message},{default:o(()=>[a(r,{modelValue:e(t).newEstimate.estimate_date,"onUpdate:modelValue":l[1]||(l[1]=m=>e(t).newEstimate.estimate_date=m),"content-loading":s.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(u,{label:v.$t("estimates.expiry_date"),"content-loading":s.isLoading},{default:o(()=>[a(r,{modelValue:e(t).newEstimate.expiry_date,"onUpdate:modelValue":l[2]||(l[2]=m=>e(t).newEstimate.expiry_date=m),"content-loading":s.isLoading,"calendar-button":!0,"calendar-button-icon":"calendar"},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading"]),a(u,{label:v.$t("estimates.estimate_number"),"content-loading":s.isLoading,required:"",error:s.v.estimate_number.$error&&s.v.estimate_number.$errors[0].$message},{default:o(()=>[a(c,{modelValue:e(t).newEstimate.estimate_number,"onUpdate:modelValue":l[3]||(l[3]=m=>e(t).newEstimate.estimate_number=m),"content-loading":s.isLoading},null,8,["modelValue","content-loading"])]),_:1},8,["label","content-loading","error"]),a(pe,{store:e(t),"store-prop":"newEstimate",v:s.v,"is-loading":s.isLoading,"is-edit":s.isEdit,"customer-currency":e(t).newEstimate.currency_id},null,8,["store","v","is-loading","is-edit","customer-currency"])]),_:1})])}}},ve=["onSubmit"],be={class:"flex"},ye={class:"block mt-10 estimate-foot lg:flex lg:justify-between lg:items-start"},we={class:"relative w-full lg:w-1/2"},qe={setup(s){const t=j(),v=ae(),l=se(),$=ne(),{t:r}=O(),u="newEstimate";let c=I(!1);const S=I(["customer","company","customerCustom","estimate","estimateCustom"]);let m=z(),q=J(),g=b(()=>t.isFetchingInitialSettings),L=b(()=>_.value?r("estimates.edit_estimate"):r("estimates.new_estimate")),_=b(()=>m.name==="estimates.edit");const T=b(()=>l.selectedCompanySettings.sales_tax_us_enabled==="YES"&&v.salesTaxUSEnabled),P={estimate_date:{required:f.withMessage(r("validation.required"),E)},estimate_number:{required:f.withMessage(r("validation.required"),E)},reference_number:{maxLength:f.withMessage(r("validation.price_maxlength"),Y(255))},customer_id:{required:f.withMessage(r("validation.required"),E)},exchange_rate:{required:A(function(){return f.withMessage(r("validation.required"),E),t.showExchangeRate}),decimal:f.withMessage(r("validation.valid_exchange_rate"),K)}},w=Q(P,b(()=>t.newEstimate),{$scope:u});W(()=>t.newEstimate.customer,n=>{n&&n.currency?t.newEstimate.selectedCurrency=n.currency:t.newEstimate.selectedCurrency=l.selectedCompanyCurrency}),t.resetCurrentEstimate(),$.resetCustomFields(),w.value.$reset,t.fetchEstimateInitialSettings(_.value);async function M(){if(w.value.$touch(),w.value.$invalid)return!1;c.value=!0;let n={...t.newEstimate,sub_total:t.getSubTotal,total:t.getTotal,tax:t.getTotalTax};const C=_.value?t.updateEstimate:t.addEstimate;try{let d=await C(n);d.data.data&&q.push(`/admin/estimates/${d.data.data.id}/view`)}catch(d){console.error(d)}c.value=!1}return(n,C)=>{const d=i("BaseBreadcrumbItem"),F=i("BaseBreadcrumb"),k=i("BaseButton"),N=i("router-link"),U=i("BaseIcon"),G=i("BasePageHeader"),D=i("BaseScrollPane"),R=i("BasePage");return p(),x(te,null,[a(ie),a(oe),a(ge),e(T)&&(!e(g)||e(m).query.customer)?(p(),y(le,{key:0,store:e(t),"store-prop":"newEstimate","is-edit":e(_),customer:e(t).newEstimate.customer},null,8,["store","is-edit","customer"])):h("",!0),a(R,{class:"relative estimate-create-page"},{default:o(()=>[B("form",{onSubmit:ee(M,["prevent"])},[a(G,{title:e(L)},{actions:o(()=>[n.$route.name==="estimates.edit"?(p(),y(N,{key:0,to:`/estimates/pdf/${e(t).newEstimate.unique_hash}`,target:"_blank"},{default:o(()=>[a(k,{class:"mr-3",variant:"primary-outline",type:"button"},{default:o(()=>[B("span",be,V(n.$t("general.view_pdf")),1)]),_:1})]),_:1},8,["to"])):h("",!0),a(k,{loading:e(c),disabled:e(c),"content-loading":e(g),variant:"primary",type:"submit"},{left:o(H=>[e(c)?h("",!0):(p(),y(U,{key:0,class:X(H.class),name:"SaveIcon"},null,8,["class"]))]),default:o(()=>[Z(" "+V(n.$t("estimates.save_estimate")),1)]),_:1},8,["loading","disabled","content-loading"])]),default:o(()=>[a(F,null,{default:o(()=>[a(d,{title:n.$t("general.home"),to:"/admin/dashboard"},null,8,["title"]),a(d,{title:n.$tc("estimates.estimate",2),to:"/admin/estimates"},null,8,["title"]),n.$route.name==="estimates.edit"?(p(),y(d,{key:0,title:n.$t("estimates.edit_estimate"),to:"#",active:""},null,8,["title"])):(p(),y(d,{key:1,title:n.$t("estimates.new_estimate"),to:"#",active:""},null,8,["title"]))]),_:1})]),_:1},8,["title"]),a(fe,{v:e(w),"is-loading":e(g),"is-edit":e(_)},null,8,["v","is-loading","is-edit"]),a(D,null,{default:o(()=>[a(re,{currency:e(t).newEstimate.selectedCurrency,"is-loading":e(g),"item-validation-scope":u,store:e(t),"store-prop":"newEstimate"},null,8,["currency","is-loading","store"]),B("div",ye,[B("div",we,[a(me,{store:e(t),"store-prop":"newEstimate",fields:S.value,type:"Estimate"},null,8,["store","fields"]),a(ce,{type:"Estimate","is-edit":e(_),"is-loading":e(g),store:e(t),"store-prop":"newEstimate","custom-field-scope":u,class:"mb-6"},null,8,["is-edit","is-loading","store"]),a(de,{store:e(t),"component-name":"EstimateTemplate","store-prop":"newEstimate"},null,8,["store"])]),a(ue,{currency:e(t).newEstimate.selectedCurrency,"is-loading":e(g),store:e(t),"store-prop":"newEstimate","tax-popup-type":"estimate"},null,8,["currency","is-loading","store"])])]),_:1})],40,ve)]),_:1})],64)}}};export{qe as default};
